<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monad MCP Block Explorer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7fafc;
      padding: 20px;
      text-align: center;
    }
    input, button {
      padding: 10px;
      margin: 10px 5px;
      border-radius: 5px;
    }
    .result, .block-info, .status {
      margin-top: 20px;
      padding: 15px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>
  <h1>Monad MCP Block Explorer</h1>
  <p>Track latest blocks and search transactions from Monad Testnet</p>

  <!-- Search Box -->
  <input type="text" id="queryInput" placeholder="Enter address or tx hash" />
  <button onclick="handleSearch()">Search</button>

  <!-- Status Indicator -->
  <div class="status" id="status">ðŸ”´ Not Connected</div>

  <!-- Latest Block Display -->
  <div class="block-info" id="latestBlock">Loading latest block...</div>

  <!-- Search Results -->
  <div class="result" id="searchResult"></div>

  <script>
    const statusEl = document.getElementById("status");
    const latestBlockEl = document.getElementById("latestBlock");
    const resultEl = document.getElementById("searchResult");

    async function fetchLatestBlock() {
      try {
        const res = await fetch("https://monad-mcp-server1.onrender.com/latestblock");
        const data = await res.json();
        latestBlockEl.innerHTML = `
          <strong>Latest Block:</strong> #${data.latestBlock}<br>
          <strong>Transactions:</strong> ${data.transactions}
        `;
        statusEl.innerText = "ðŸŸ¢ Connected";
      } catch (err) {
        latestBlockEl.innerText = "Error fetching latest block.";
        statusEl.innerText = "ðŸ”´ Not Connected";
      }
    }

    async function handleSearch() {
      const query = document.getElementById("queryInput").value.trim();
      if (!query) return;

      resultEl.innerHTML = "Searching...";
      try {
        const res = await fetch(`https://monad-mcp-server1.onrender.com/search/${query}`);
        if (!res.ok) throw new Error("Not found");
        const data = await res.json();

        const tx = data.transaction;
        const blk = data.block;

        resultEl.innerHTML = `
          <h3>Transaction Details</h3>
          <p><strong>Hash:</strong> ${tx.hash}</p>
          <p><strong>From:</strong> ${tx.from}</p>
          <p><strong>To:</strong> ${tx.to}</p>
          <p><strong>Block Number:</strong> ${blk.number}</p>
          <p><strong>Timestamp:</strong> ${new Date(blk.timestamp * 1000).toLocaleString()}</p>
        `;
      } catch (err) {
        resultEl.innerHTML = `<p style="color: red;">Transaction or address not found.</p>`;
      }
    }

    // Refresh block every 10s
    fetchLatestBlock();
    setInterval(fetchLatestBlock, 10000);
  </script>
</body>
</html>
